<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>
   Booster Pack Simulator - HatakeSocial
  </title>
  <script src="https://cdn.tailwindcss.com">
  </script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet"/>
  <link href="css/style.css" rel="stylesheet"/>
 </head>
 <body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-200 font-sans">
  <div class="flex h-screen">
   <aside class="w-64 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 flex-shrink-0 hidden lg:flex flex-col">
    <div class="h-28 flex items-center justify-center border-b border-gray-200 dark:border-gray-700 px-4">
     <a class="flex flex-col items-center space-y-1" href="index.html">
      <img alt="HatakeSocial Logo" class="h-16" onerror="this.onerror=null; this.src='https://placehold.co/150x40?text=HatakeSocial';" src="https://i.imgur.com/B06rBhI.png"/>
      <span class="font-bold text-lg text-blue-600 dark:text-blue-400">
       HatakeSocial
      </span>
     </a>
    </div>
    <nav class="flex-1 px-4 py-6 space-y-2">
     <a class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md" href="index.html">
      <i class="fas fa-home w-6 text-center">
      </i>
      <span class="ml-3">
       Feed
      </span>
     </a>
     <a class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md" href="messages.html">
      <i class="fas fa-comments w-6 text-center">
      </i>
      <span class="ml-3">
       Messages
      </span>
     </a>
     <a class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md" href="community.html">
      <i class="fas fa-users w-6 text-center">
      </i>
      <span class="ml-3">
       Community
      </span>
     </a>
     <a class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md" href="articles.html">
      <i class="fas fa-newspaper w-6 text-center">
      </i>
      <span class="ml-3">
       Articles
      </span>
     </a>
     <a class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md" href="events.html">
      <i class="fas fa-calendar-alt w-6 text-center">
      </i>
      <span class="ml-3">
       Events
      </span>
     </a>
     <a class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md" href="my_collection.html">
      <i class="fas fa-layer-group w-6 text-center">
      </i>
      <span class="ml-3">
       My Collection
      </span>
     </a>
     <a class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md" href="deck.html">
      <i class="fas fa-book-open w-6 text-center">
      </i>
      <span class="ml-3">
       Deck Builder
      </span>
     </a>
     <a class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md" href="shop.html">
      <i class="fas fa-shopping-cart w-6 text-center">
      </i>
      <span class="ml-3">
       Shop
      </span>
     </a>
     <a class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md" href="marketplace.html">
      <i class="fas fa-store w-6 text-center">
      </i>
      <span class="ml-3">
       Marketplace
      </span>
     </a>
     <a class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md" href="trades.html">
      <i class="fas fa-exchange-alt w-6 text-center">
      </i>
      <span class="ml-3">
       Trades
      </span>
     </a>
     <a class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md" href="profile.html">
      <i class="fas fa-user w-6 text-center">
      </i>
      <span class="ml-3">
       Profile
      </span>
     </a>
     <a class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md" href="settings.html">
      <i class="fas fa-cog w-6 text-center">
      </i>
      <span class="ml-3">
       Settings
      </span>
     </a>
     <a class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md" href="about.html">
      <i class="fas fa-info-circle w-6 text-center">
      </i>
      <span class="ml-3">
       About Us
      </span>
     </a>
    </nav>
    <div class="p-4 border-t border-gray-200 dark:border-gray-700 hidden" id="sidebar-user-info">
    </div>
   </aside>
   <main class="flex-1 flex flex-col overflow-y-auto">
    <header class="h-28 flex items-center justify-between px-6 border-b border-gray-200 dark:border-gray-700 flex-shrink-0">
     <div class="flex items-center">
      <button class="lg:hidden mr-4 text-gray-600 dark:text-gray-300" id="sidebar-toggle">
       <i class="fas fa-bars text-xl">
       </i>
      </button>
      <div class="relative">
       <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
       </i>
       <input class="w-full md:w-96 pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-full bg-gray-50 dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500" id="main-search-bar" placeholder="Search for cards, users, or articles..." type="text"/>
       <div class="absolute mt-2 w-full md:w-96 bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-lg shadow-xl z-10 hidden" id="main-search-results">
       </div>
      </div>
     </div>
     <div class="flex items-center space-x-5" id="user-actions">
     </div>
    </header>
    <main class="flex-grow container mx-auto px-4 py-8">
     <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md mb-8">
      <h1 class="text-4xl font-extrabold text-gray-800 dark:text-white mb-6 text-center">
       Booster Pack Simulator
      </h1>
      <div class="flex flex-col md:flex-row items-center space-y-4 md:space-y-0 md:space-x-4">
       <select class="w-full p-3 border rounded-md dark:bg-gray-700 dark:border-gray-600 focus:ring-2 focus:ring-blue-500" id="booster-set-select">
        <option>
         Loading sets...
        </option>
       </select>
       <button class="w-full md:w-auto bg-purple-600 text-white py-3 px-8 rounded-full hover:bg-purple-700 whitespace-nowrap font-bold text-lg transition-transform transform hover:scale-105" id="generate-booster-btn">
        <i class="fas fa-box-open mr-2">
        </i>
        Generate Booster
       </button>
      </div>
      <p class="text-center text-sm mt-4 dark:text-gray-400 h-5" id="booster-status">
      </p>
      <div class="mt-6 grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-8 gap-4 min-h-[200px]" id="booster-pack-results">
      </div>
     </div>
    </main>
    <footer class="bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 mt-auto">
     <div class="container mx-auto py-8 px-4">
      <div class="grid grid-cols-2 md:grid-cols-4 gap-8">
       <div>
        <h3 class="font-bold text-gray-900 dark:text-white mb-4">
         HatakeSocial
        </h3>
        <p class="text-gray-600 dark:text-gray-400 text-sm">
         The all-in-one platform for TCG enthusiasts.
        </p>
       </div>
       <div>
        <h3 class="font-bold text-gray-900 dark:text-white mb-4">
         Company
        </h3>
        <ul class="space-y-2 text-sm">
         <li>
          <a class="text-gray-600 dark:text-gray-400 hover:text-blue-500" href="about.html">
           About Us
          </a>
         </li>
         <li>
          <a class="text-gray-600 dark:text-gray-400 hover:text-blue-500" href="partner.html">
           Partners
          </a>
         </li>
         <li>
          <a class="text-gray-600 dark:text-gray-400 hover:text-blue-500" href="contact.html">
           Contact
          </a>
         </li>
        </ul>
       </div>
       <div>
        <h3 class="font-bold text-gray-900 dark:text-white mb-4">
         Legal
        </h3>
        <ul class="space-y-2 text-sm">
         <li>
          <a class="text-gray-600 dark:text-gray-400 hover:text-blue-500" href="#">
           Privacy Policy
          </a>
         </li>
         <li>
          <a class="text-gray-600 dark:text-gray-400 hover:text-blue-500" href="#">
           Terms of Service
          </a>
         </li>
        </ul>
       </div>
       <div>
        <h3 class="font-bold text-gray-900 dark:text-white mb-4">
         Display Options
        </h3>
        <div class="flex items-center space-x-4">
         <div>
          <label class="text-sm text-gray-600 dark:text-gray-400" for="theme-toggle">
           Theme
          </label>
          <button class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5" id="theme-toggle" type="button">
           <i class="fas fa-sun hidden" id="theme-toggle-sun-icon">
           </i>
           <i class="fas fa-moon hidden" id="theme-toggle-moon-icon">
           </i>
          </button>
         </div>
         <div id="currency-selector-container">
         </div>
        </div>
       </div>
      </div>
      <div class="mt-8 border-t border-gray-200 dark:border-gray-700 pt-8 flex flex-col md:flex-row justify-between items-center text-sm text-gray-500 dark:text-gray-400">
       <p>
        © 2025 Hatake. All Rights Reserved.
       </p>
       <div class="flex space-x-6 mt-4 md:mt-0">
        <a class="hover:text-gray-900 dark:hover:text-white" href="#">
         <i class="fab fa-twitter">
         </i>
        </a>
        <a class="hover:text-gray-900 dark:hover:text-white" href="#">
         <i class="fab fa-facebook-f">
         </i>
        </a>
        <a class="hover:text-gray-900 dark:hover:text-white" href="#">
         <i class="fab fa-instagram">
         </i>
        </a>
       </div>
      </div>
     </div>
    </footer>
    <!-- Firebase Libraries (use the compat libraries for v8 syntax) -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js">
    </script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js">
    </script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js">
    </script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-storage-compat.js">
    </script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-functions-compat.js">
    </script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-analytics-compat.js">
    </script>
    <script src="js/auth.js">
    </script>
    <script src="js/darkmode.js">
    </script>
    <script>
     /**
     * HatakeSocial - Booster Pack Simulator Script (v13 - Scryfall Final)
     */
    document.addEventListener('authReady', () => {
        const boosterPageContainer = document.getElementById('generate-booster-btn');
        if (!boosterPageContainer) return;

        const generateBtn = document.getElementById('generate-booster-btn');
        const setSelect = document.getElementById('booster-set-select');
        const resultsContainer = document.getElementById('booster-pack-results');
        const statusEl = document.getElementById('booster-status');

        const populateSetList = async () => {
            statusEl.textContent = 'Fetching set list...';
            try {
                const response = await fetch('https://api.scryfall.com/sets');
                if (!response.ok) throw new Error(`Scryfall API Error: ${response.statusText}`);
                
                const setData = await response.json();
                setSelect.innerHTML = '';

                // FINAL FIX: This filter is the most robust for finding booster-eligible sets from Scryfall
                const boosterSets = setData.data
                    .filter(set => set.booster && !set.digital && (set.set_type === 'core' || set.set_type === 'expansion' || set.set_type === 'masters' || set.set_type === 'draft_innovation'))
                    .sort((a, b) => new Date(b.released_at) - new Date(a.released_at));

                if (boosterSets.length === 0) {
                     throw new Error("Filtering resulted in 0 sets. Scryfall may be having issues.");
                }

                boosterSets.forEach(set => {
                    const option = document.createElement('option');
                    option.value = set.code;
                    option.textContent = set.name;
                    setSelect.appendChild(option);
                });
                
                statusEl.textContent = 'Select a set and generate a booster pack!';

            } catch (error) {
                console.error("Error populating set list:", error);
                statusEl.innerHTML = `<strong>Error: Load failed.</strong> Could not retrieve or process the set list.`;
                setSelect.innerHTML = '<option>Could not load sets</option>';
            }
        };

        const generateBooster = async () => {
            const setCode = setSelect.value;
            if (!setCode || setCode === 'Could not load sets') return;

            generateBtn.disabled = true;
            generateBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Generating...';
            statusEl.textContent = `Generating booster for ${setSelect.options[setSelect.selectedIndex].text}...`;
            resultsContainer.innerHTML = '';
            
            try {
                const response = await fetch(`https://api.scryfall.com/sets/${setCode}/booster`);
                if (!response.ok) {
                     if(response.status === 404) {
                        throw new Error(`Scryfall does not have booster data for this set.`);
                     }
                     throw new Error(`Scryfall API Error: ${response.statusText}`);
                }
                
                const boosterData = await response.json();
                if (!boosterData.data || boosterData.data.length === 0) {
                     throw new Error('Received empty booster pack data from Scryfall.');
                }

                boosterData.data.forEach(card => {
                    const imgEl = document.createElement('img');
                    imgEl.src = card.image_uris?.normal || 'https://placehold.co/223x310/cccccc/969696?text=Image+Not+Found';
                    imgEl.alt = card.name;
                    imgEl.title = `${card.name} (${card.rarity})`;
                    imgEl.className = 'rounded-lg shadow-md w-full transition-transform hover:scale-105 cursor-pointer';
                    imgEl.addEventListener('click', () => window.open(card.scryfall_uri, '_blank'));
                    resultsContainer.appendChild(imgEl);
                });
                
                statusEl.textContent = `Generated a booster pack from ${boosterData.data[0].set_name}!`;

            } catch (error) {
                console.error('Error generating booster:', error);
                statusEl.textContent = `Error: ${error.message}`;
                resultsContainer.innerHTML = `<p class="col-span-full text-center text-red-500">${error.message}</p>`;
            } finally {
                generateBtn.disabled = false;
                generateBtn.innerHTML = '<i class="fas fa-box-open mr-2"></i>Generate Booster';
            }
        };

        generateBtn.addEventListener('click', generateBooster);
        populateSetList();
    });
    </script>
   </main>
  </div>
  <!-- Login Modal -->
  <div class="separator">
   Or continue with
  </div>
  <button class="w-full btn-secondary" id="googleRegisterButton">
   <img alt="Google icon" class="w-5 h-5" src="https://www.svgrepo.com/show/475656/google-color.svg"/>
   <span class="ml-3">
    Sign up with Google
   </span>
  </button>
  <div class="modal" id="authModal">
   <div class="modal-content">
    <span class="close-button">
     ×
    </span>
    <div class="auth-form" id="login-form-modal">
     <h2>
      Login
     </h2>
     <form>
      <input id="loginEmail" placeholder="Email" required="" type="email"/>
      <input id="loginPassword" placeholder="Password" required="" type="password"/>
      <button id="loginUser" type="button">
       Login
      </button>
     </form>
    </div>
    <div class="auth-form" id="register-form-modal" style="display:none;">
     <h2>
      Register
     </h2>
     <form>
      <input id="registerUsername" placeholder="Username" required="" type="text"/>
      <input id="registerEmail" placeholder="Email" required="" type="email"/>
      <input id="registerPassword" placeholder="Password" required="" type="password"/>
      <button id="registerUser" type="button">
       Register
      </button>
     </form>
    </div>
    <div class="modal-switch">
     <p id="switchToRegister">
      Don't have an account?
      <a href="#">
       Register
      </a>
     </p>
     <p id="switchToLogin" style="display:none;">
      Already have an account?
      <a href="#">
       Login
      </a>
     </p>
    </div>
   </div>
  </div>
 </body>
</html>
