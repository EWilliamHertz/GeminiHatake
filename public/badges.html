<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Badges - HatakeSocial</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"/>
    <link rel="stylesheet" href="css/style.css"/>
    <link rel="manifest" href="/manifest.json"/>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-200 font-sans overflow-hidden">
    <div class="flex h-screen">
        <!-- Sidebar Overlay -->
        <div class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden lg:hidden" id="sidebar-overlay"></div>
        
        <!-- Sidebar -->
        <aside class="w-64 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 flex-shrink-0 flex flex-col fixed inset-y-0 left-0 z-50 lg:relative lg:translate-x-0 -translate-x-full transition-transform duration-300 ease-in-out" id="sidebar">
            <div class="h-28 flex items-center justify-center border-b border-gray-200 dark:border-gray-700 px-4">
                <a href="app.html" class="flex flex-col items-center space-y-1">
                    <img src="https://firebasestorage.googleapis.com/v0/b/hatakesocial-88b5e.firebasestorage.app/o/IMG_7951.png?alt=media&token=e7c2dc48-2836-4feb-9fc7-324aecacba6b" alt="HatakeSocial Logo" class="h-16" onerror="this.onerror=null; this.src='https://placehold.co/150x40?text=HatakeSocial';">
                    <span class="font-bold text-lg text-blue-600 dark:text-blue-400">HatakeSocial</span>
                </a>
            </div>
            
            <nav class="flex-1 px-4 py-6 space-y-2 overflow-y-auto">
                <a href="app.html" class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md">
                    <i class="fas fa-home w-6 text-center"></i>
                    <span class="ml-3">Feed</span>
                </a>
                <a href="profile.html" class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md">
                    <i class="fas fa-user w-6 text-center"></i>
                    <span class="ml-3">Profile</span>
                </a>
                <a href="my_collection.html" class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md">
                    <i class="fas fa-layer-group w-6 text-center"></i>
                    <span class="ml-3">My Collection</span>
                </a>
                <a href="badges.html" class="flex items-center px-4 py-2 bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-300 rounded-md">
                    <i class="fas fa-award w-6 text-center"></i>
                    <span class="ml-3">My Badges</span>
                </a>
                <a href="trades.html" class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md">
                    <i class="fas fa-exchange-alt w-6 text-center"></i>
                    <span class="ml-3">Trades</span>
                </a>
                <a href="marketplace.html" class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md">
                    <i class="fas fa-store w-6 text-center"></i>
                    <span class="ml-3">Marketplace</span>
                </a>
            </nav>
            
            <div class="p-4 border-t border-gray-200 dark:border-gray-700">
                <button id="logout-btn" class="w-full flex items-center px-4 py-2 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900 rounded-md">
                    <i class="fas fa-sign-out-alt w-6 text-center"></i>
                    <span class="ml-3">Logout</span>
                </button>
            </div>
        </aside>
        
        <!-- Main Content -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- Top Navigation -->
            <header class="h-16 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between px-6">
                <div class="flex items-center space-x-4">
                    <button id="sidebar-toggle" class="lg:hidden text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                    <h1 class="text-2xl font-bold text-gray-900 dark:text-white">
                        <i class="fas fa-award text-yellow-500"></i> My Badges
                    </h1>
                </div>
                
                <div class="flex items-center space-x-4">
                    <button id="theme-toggle" class="p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700">
                        <i class="fas fa-moon dark:hidden"></i>
                        <i class="fas fa-sun hidden dark:inline"></i>
                    </button>
                    <a href="notifications.html" class="p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 relative">
                        <i class="fas fa-bell"></i>
                        <span id="notification-badge" class="hidden absolute top-0 right-0 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
                    </a>
                </div>
            </header>
            
            <!-- Page Content -->
            <main class="flex-1 overflow-y-auto p-6">
                <!-- Badge Statistics -->
                <div id="badge-stats" class="mb-8"></div>
                
                <!-- Tabs -->
                <div class="mb-6">
                    <div class="border-b border-gray-200 dark:border-gray-700">
                        <nav class="-mb-px flex space-x-8">
                            <button id="tab-earned" class="tab-button border-b-2 border-blue-500 text-blue-600 dark:text-blue-400 py-4 px-1 text-sm font-medium">
                                Earned Badges
                            </button>
                            <button id="tab-progress" class="tab-button border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300 py-4 px-1 text-sm font-medium">
                                Progress
                            </button>
                        </nav>
                    </div>
                </div>
                
                <!-- Tab Content -->
                <div id="tab-content-earned" class="tab-content">
                    <div id="earned-badges-container"></div>
                </div>
                
                <div id="tab-content-progress" class="tab-content hidden">
                    <div id="badge-progress-container"></div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-functions-compat.js"></script>
    <script src="js/firebase-config.js"></script>
    <script src="js/badgeSystem.js"></script>
    
    <script>
        let currentUser = null;
        
        // Auth state observer
        firebase.auth().onAuthStateChanged(async (user) => {
            if (user) {
                currentUser = user;
                
                // Initialize badge system
                BadgeSystem.initBadgeSystem(user.uid);
                
                // Load badge stats
                await BadgeSystem.displayBadgeStats(user.uid, 'badge-stats');
                
                // Load earned badges
                await BadgeSystem.displayUserBadges(user.uid, 'earned-badges-container');
                
                // Load badge progress
                await BadgeSystem.displayBadgeProgress('badge-progress-container');
            } else {
                window.location.href = 'index.html';
            }
        });
        
        // Tab switching
        document.getElementById('tab-earned').addEventListener('click', () => {
            document.getElementById('tab-earned').classList.add('border-blue-500', 'text-blue-600', 'dark:text-blue-400');
            document.getElementById('tab-earned').classList.remove('border-transparent', 'text-gray-500');
            document.getElementById('tab-progress').classList.remove('border-blue-500', 'text-blue-600', 'dark:text-blue-400');
            document.getElementById('tab-progress').classList.add('border-transparent', 'text-gray-500');
            
            document.getElementById('tab-content-earned').classList.remove('hidden');
            document.getElementById('tab-content-progress').classList.add('hidden');
        });
        
        document.getElementById('tab-progress').addEventListener('click', () => {
            document.getElementById('tab-progress').classList.add('border-blue-500', 'text-blue-600', 'dark:text-blue-400');
            document.getElementById('tab-progress').classList.remove('border-transparent', 'text-gray-500');
            document.getElementById('tab-earned').classList.remove('border-blue-500', 'text-blue-600', 'dark:text-blue-400');
            document.getElementById('tab-earned').classList.add('border-transparent', 'text-gray-500');
            
            document.getElementById('tab-content-progress').classList.remove('hidden');
            document.getElementById('tab-content-earned').classList.add('hidden');
        });
        
        // Sidebar toggle
        document.getElementById('sidebar-toggle').addEventListener('click', () => {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            
            sidebar.classList.toggle('-translate-x-full');
            overlay.classList.toggle('hidden');
        });
        
        document.getElementById('sidebar-overlay').addEventListener('click', () => {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            
            sidebar.classList.add('-translate-x-full');
            overlay.classList.add('hidden');
        });
        
        // Theme toggle
        document.getElementById('theme-toggle').addEventListener('click', () => {
            document.documentElement.classList.toggle('dark');
            const isDark = document.documentElement.classList.contains('dark');
            localStorage.setItem('darkMode', isDark);
        });
        
        // Load dark mode preference
        if (localStorage.getItem('darkMode') === 'true') {
            document.documentElement.classList.add('dark');
        }
        
        // Logout
        document.getElementById('logout-btn').addEventListener('click', async () => {
            try {
                await firebase.auth().signOut();
                window.location.href = 'index.html';
            } catch (error) {
                console.error('Error signing out:', error);
            }
        });
    </script>
</body>
</html>
