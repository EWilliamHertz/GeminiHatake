<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>
   My Collection - HatakeSocial
  </title>
  <script src="https://cdn.tailwindcss.com">
  </script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <!-- Toastify CSS -->
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
  <link href="css/style.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js">
  </script>
  <link href="/manifest.json" rel="manifest">
  <style>
    /* Style for the hover-to-enlarge image preview */
    #card-hover-preview {
        position: fixed;
        border: 3px solid #fff;
        border-radius: 12px;
        box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        pointer-events: none; /* Allows mouse events to pass through */
        transform: scale(0.95);
        opacity: 0;
        transition: transform 0.1s ease-out, opacity 0.1s ease-out;
        z-index: 1003; /* Ensures it's on top of modals */
    }
  </style>
 </head>
 <body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-200 font-sans overflow-hidden">
  <div class="flex h-screen">
   <div class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden lg:hidden" id="sidebar-overlay">
   </div>
   <aside class="w-64 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 flex-shrink-0 flex flex-col fixed inset-y-0 left-0 z-50 lg:relative lg:translate-x-0 -translate-x-full transition-transform duration-300 ease-in-out" id="sidebar">
    <div class="h-28 flex items-center justify-center border-b border-gray-200 dark:border-gray-700 px-4">
     <a class="flex flex-col items-center space-y-1" href="app.html">
      <img alt="HatakeSocial Logo" class="h-16" onerror="this.onerror=null; this.src='https://placehold.co/150x40?text=HatakeSocial';" src="https://i.imgur.com/B06rBhI.png">
      <span class="font-bold text-lg text-blue-600 dark:text-blue-400">
       HatakeSocial
      </span>
     </a>
    </div>
    <nav class="flex-1 px-4 py-6 space-y-2 overflow-y-auto">
        <a class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md" href="app.html"><i class="fas fa-home w-6 text-center"></i><span class="ml-3">Feed</span></a>
        <a class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md" href="messages.html"><i class="fas fa-comments w-6 text-center"></i><span class="ml-3">Messages</span></a>
        <a class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md" href="community.html"><i class="fas fa-users w-6 text-center"></i><span class="ml-3">Community</span></a>
        <a class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md" href="articles.html?type=tcg"><i class="fas fa-newspaper w-6 text-center"></i><span class="ml-3">TCG Articles</span></a>
        <a class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md" href="articles.html?type=blog"><i class="fas fa-blog w-6 text-center"></i><span class="ml-3">Hatake Blog</span></a>
        <a class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md" href="events.html"><i class="fas fa-calendar-alt w-6 text-center"></i><span class="ml-3">Events</span></a>
        <a class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md bg-blue-100 dark:bg-blue-900/50" href="my_collection.html"><i class="fas fa-layer-group w-6 text-center"></i><span class="ml-3">My Collection</span></a>
        <a class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md" href="deck.html"><i class="fas fa-book-open w-6 text-center"></i><span class="ml-3">Deck Builder</span></a>
        <a class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md" href="shop.html"><i class="fas fa-shopping-cart w-6 text-center"></i><span class="ml-3">Shop</span></a>
        <a class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md" href="marketplace.html"><i class="fas fa-store w-6 text-center"></i><span class="ml-3">Marketplace</span></a>
        <a class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md" href="trades.html"><i class="fas fa-exchange-alt w-6 text-center"></i><span class="ml-3">Trades</span></a>
        <a class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md" href="profile.html"><i class="fas fa-user w-6 text-center"></i><span class="ml-3">Profile</span></a>
        <a class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md" href="settings.html"><i class="fas fa-cog w-6 text-center"></i><span class="ml-3">Settings</span></a>
        <a class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md" href="about.html"><i class="fas fa-info-circle w-6 text-center"></i><span class="ml-3">About Us</span></a>
    </nav>
    <div class="p-4 border-t border-gray-200 dark:border-gray-700 hidden" id="sidebar-user-info">
    </div>
   </aside>
   <div class="flex-1 flex flex-col overflow-y-auto">
    <header class="h-28 flex items-center justify-between px-6 border-b border-gray-200 dark:border-gray-700 flex-shrink-0">
     <div class="flex items-center">
      <button class="lg:hidden mr-4 text-gray-600 dark:text-gray-300" id="sidebar-toggle">
       <i class="fas fa-bars text-xl">
       </i>
      </button>
      <div class="relative">
       <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
       </i>
       <input class="w-full md:w-96 pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-full bg-gray-50 dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500" id="main-search-bar" placeholder="Search..." type="text">
      </div>
     </div>
     <div class="flex items-center space-x-5" id="user-actions">
      <!-- Dynamically filled by auth.js -->
     </div>
    </header>
    <main class="flex-grow container mx-auto px-4 py-8">
     <div class="mb-6 border-b border-gray-200 dark:border-gray-700">
      <nav aria-label="Tabs" class="flex -mb-px space-x-8">
       <button class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-lg text-blue-600 border-blue-600" id="tab-collection">
        My Collection
       </button>
       <button class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-lg text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300" id="tab-wishlist">
        My Wishlist
       </button>
      </nav>
     </div>
     <div class="mb-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-center" id="collection-stats-section">
      <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow">
       <h4 class="text-sm font-medium text-gray-500 dark:text-gray-400">Total Items</h4>
       <p class="text-2xl font-bold dark:text-white" id="stats-total-cards">0</p>
      </div>
      <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow">
       <h4 class="text-sm font-medium text-gray-500 dark:text-gray-400">Unique Items</h4>
       <p class="text-2xl font-bold dark:text-white" id="stats-unique-cards">0</p>
      </div>
      <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow">
       <h4 class="text-sm font-medium text-gray-500 dark:text-gray-400">Total Value</h4>
       <p class="text-2xl font-bold dark:text-white" id="stats-total-value">$0.00</p>
      </div>
      <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow">
       <h4 class="text-sm font-medium text-gray-500 dark:text-gray-400">Rarity Breakdown</h4>
       <div class="text-lg font-bold dark:text-white flex justify-center space-x-3 mt-2" id="stats-rarity-breakdown"></div>
      </div>
     </div>
     <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md mb-8">
      <h2 class="text-2xl font-bold mb-4 dark:text-white">Add to Your Lists</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
       <div>
        <h3 class="text-lg font-semibold mb-2 dark:text-gray-200">Manually Add a Card</h3>
        <div class="space-y-3" id="manual-add-form">
         <select class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600" id="manual-game-select">
          <option value="magic">Magic: The Gathering</option>
          <option value="pokemon">Pokémon</option>
         </select>
         <input class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600" id="manual-card-name" placeholder="Card Name (e.g., Sol Ring)" required type="text">
         <button class="w-full bg-blue-600 text-white py-2 rounded-full hover:bg-blue-700" id="search-card-versions-btn" type="button">Search for Card</button>
        </div>
       </div>
       <div>
        <h3 class="text-lg font-semibold mb-2 dark:text-gray-200"><i class="fas fa-box mr-2 text-purple-600"></i>Add Sealed Product</h3>
        <div class="space-y-3" id="sealed-add-form">
         <select class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600" id="sealed-game-select">
          <option value="magic">Magic: The Gathering</option>
          <option value="pokemon">Pokémon</option>
         </select>
         <select class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600" id="sealed-product-type">
          <option value="booster_box">Booster Box</option>
          <option value="booster_pack">Booster Pack</option>
          <option value="bundle">Bundle</option>
          <option value="prerelease_kit">Prerelease Kit</option>
          <option value="commander_deck">Commander Deck</option>
          <option value="starter_deck">Starter Deck</option>
         </select>
         <input class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600" id="sealed-set-name" placeholder="Set/Expansion" required type="text">
         <button class="w-full bg-purple-600 text-white py-2 rounded-full hover:bg-purple-700" id="add-sealed-product-btn" type="button"><i class="fas fa-plus mr-2"></i>Add Sealed</button>
        </div>
       </div>
       <div>
        <h3 class="text-lg font-semibold mb-2 dark:text-gray-200">Import from ManaBox (.csv)</h3>
        <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">Export your collection from ManaBox and upload it here.</p>
        <input accept=".csv" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 dark:file:bg-blue-900/50 file:text-blue-700 dark:file:text-blue-300 hover:file:bg-blue-100" id="csv-upload-input" type="file">
        <button class="w-full mt-3 bg-green-600 text-white py-2 rounded-full hover:bg-green-700" id="csv-upload-btn">Upload CSV</button>
        <div class="text-center text-sm mt-2 dark:text-gray-400" id="csv-status"></div>
       </div>
       <div>
        <h3 class="text-lg font-semibold mb-2 dark:text-gray-200">Bulk Add from Text</h3>
        <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">Paste a list of cards for a guided import process.</p>
        <a class="w-full mt-3 bg-indigo-600 text-white py-2 px-4 rounded-full hover:bg-indigo-700 text-center block" href="bulk_add.html"><i class="fas fa-paste mr-2"></i>Bulk Add Tool</a>
       </div>
      </div>
     </div>
     <div class="mt-8">
      <div class="tab-content" id="content-collection">
       <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 mb-6">
        <h2 class="text-3xl font-bold text-gray-800 dark:text-white">My Collection</h2>
        <div class="flex flex-wrap items-center justify-start sm:justify-end gap-2">
         <div class="p-1 bg-gray-200 dark:bg-gray-700 rounded-full flex items-center">
          <button class="view-btn p-2 rounded-full leading-none bg-blue-600 text-white" id="grid-view-btn" title="Grid View"><i class="fas fa-th-large"></i></button>
          <button class="view-btn p-2 rounded-full leading-none text-gray-500 dark:text-gray-400" id="list-view-btn" title="List View"><i class="fas fa-list"></i></button>
         </div>
         <button class="px-4 py-2 bg-indigo-500 text-white font-semibold rounded-full hover:bg-indigo-600" id="export-collection-btn"><i class="fas fa-file-export mr-2"></i>Export as CSV</button>
         <button class="px-4 py-2 bg-gray-600 text-white font-semibold rounded-full hover:bg-gray-700" id="bulk-edit-btn">Bulk Edit</button>
        </div>
       </div>
       <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md mb-6 hidden" id="bulk-action-bar">
        <div class="flex items-center space-x-4">
            <span id="selected-count" class="text-sm font-medium text-gray-700 dark:text-gray-300">0 cards selected</span>
            <label class="flex items-center text-sm"><input type="checkbox" id="select-all-checkbox" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"><span class="ml-2">Select All</span></label>
            <button id="list-selected-btn" class="px-3 py-1.5 bg-green-600 text-white text-sm font-semibold rounded-md hover:bg-green-700">List for Sale</button>
            <button id="delete-selected-btn" class="px-3 py-1.5 bg-red-600 text-white text-sm font-semibold rounded-md hover:bg-red-700">Delete</button>
        </div>
       </div>
       <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4" id="collection-grid-view"></div>
       <div class="space-y-3 hidden" id="collection-table-view"></div>
      </div>
      <div class="tab-content hidden" id="content-wishlist">
       <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 mb-6">
        <h2 class="text-3xl font-bold text-gray-800 dark:text-white">My Wishlist</h2>
       </div>
       <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4" id="wishlist-list"></div>
      </div>
     </div>
    </main>
   </div>
  </div>
  
  <!-- Modals -->
  <div id="search-results-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[1001] hidden p-4">
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-2xl max-h-[80vh] flex flex-col">
        <div class="flex justify-between items-center p-4 border-b dark:border-gray-700"><h3 class="text-lg font-semibold text-gray-900 dark:text-white">Search Results</h3><button id="close-search-results-modal" class="text-gray-400 hover:text-gray-600"><i class="fas fa-times"></i></button></div>
        <div id="manual-add-results" class="p-4 overflow-y-auto"></div>
    </div>
  </div>

  <div id="add-version-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[1002] hidden p-4">
    <div class="bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md mx-4"><div class="flex justify-between items-center mb-4"><h3 id="modal-title" class="text-lg font-semibold text-gray-900 dark:text-white">Add Card</h3><button id="close-add-version-modal" class="text-gray-400 hover:text-gray-600"><i class="fas fa-times"></i></button></div><div class="space-y-4"><div class="flex items-center space-x-4"><img id="modal-card-image" src="" alt="Card Image" class="w-24 object-cover rounded"><div class="flex-1"><h4 id="modal-card-name" class="font-semibold text-gray-900 dark:text-white"></h4><p id="modal-card-set" class="text-sm text-gray-600 dark:text-gray-400"></p><p id="modal-card-price" class="text-sm text-green-600 font-medium"></p></div></div><div class="grid grid-cols-2 gap-4"><div><label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Quantity</label><input type="number" id="modal-quantity" min="1" value="1" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600"></div><div><label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Condition</label><select id="modal-condition" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600"><option>Near Mint</option><option>Lightly Played</option><option>Moderately Played</option><option>Heavily Played</option><option>Damaged</option></select></div></div><div><label class="block text-sm font-medium text-gray-700 dark:text-gray-300">List Type</label><select id="modal-list-type" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600"><option value="collection">Collection</option><option value="wishlist">Wishlist</option></select></div><div class="flex items-center"><input type="checkbox" id="modal-foil" class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-500 focus:ring-blue-500"><label for="modal-foil" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Foil</label></div><div><label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Notes</label><textarea id="modal-notes" rows="2" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600"></textarea></div></div><div class="flex justify-end space-x-3 mt-6"><button id="cancel-add-version-btn" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300">Cancel</button><button id="save-card-btn" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700">Save Card</button></div></div>
  </div>

  <!-- Scripts -->
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-storage-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-functions-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-analytics-compat.js"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

  <script src="js/auth.js"></script>
  
  <script src="js/modules/utils.js"></script>
  <script src="js/modules/api.js"></script>
  <script src="js/modules/card-display.js"></script>
  <script src="js/modules/card-modal.js"></script>
  <script src="js/modules/bulk-operations.js"></script>
  <script src="js/modules/card-search.js"></script>
  <script src="js/modules/csv-import.js"></script>
  <script src="js/modules/sealed-products.js"></script>
  <script src="js/modules/collection-app.js"></script>
  <script src="js/collection.js"></script>
  <script src="js/darkmode.js"></script>

  <script>
   const sidebar = document.getElementById('sidebar');
   const sidebarToggle = document.getElementById('sidebar-toggle');
   const sidebarOverlay = document.getElementById('sidebar-overlay');

   if (sidebarToggle) {
       sidebarToggle.addEventListener('click', () => {
           sidebar.classList.toggle('-translate-x-full');
           sidebarOverlay.classList.toggle('hidden');
       });
   }

   if (sidebarOverlay) {
       sidebarOverlay.addEventListener('click', () => {
           sidebar.classList.add('-translate-x-full');
           sidebarOverlay.classList.add('hidden');
       });
   }
  </script>
 </body>
</html>

