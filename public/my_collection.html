<!DOCTYPE html>
<html class="dark" lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>
   My Collection - HatakeSocial
  </title>
  <script src="https://cdn.tailwindcss.com">
  </script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
  <link href="css/style.css" rel="stylesheet"/>
  <link href="css/enhanced-pricing.css" rel="stylesheet"/>
  <script>
   tailwind.config = {
            darkMode: 'class',
            plugins: [
                function ({ addVariant }) {
                    addVariant('has-[:checked]', '&:has(:checked)')
                }
            ]
        };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="/manifest.json" rel="manifest"/>
 </head>
 <body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-200 font-sans overflow-hidden">
  <div class="flex h-screen">
   <div class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden lg:hidden" id="sidebar-overlay">
   </div>
   <aside class="w-64 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 flex-shrink-0 flex flex-col fixed inset-y-0 left-0 z-50 lg:relative lg:translate-x-0 -translate-x-full transition-transform duration-300 ease-in-out" id="sidebar">
    <div class="h-28 flex items-center justify-center border-b border-gray-200 dark:border-gray-700 px-4">
     <a class="flex flex-col items-center space-y-1" href="app.html">
      <img alt="HatakeSocial Logo" class="h-16" onerror="this.onerror=null; this.src='https://placehold.co/150x40?text=HatakeSocial';" src="https://firebasestorage.googleapis.com/v0/b/hatakesocial-88b5e.firebasestorage.app/o/IMG_7951.png?alt=media&amp;token=e7c2dc48-2836-4feb-9fc7-324aecacba6b"/>
      <span class="font-bold text-lg text-blue-600 dark:text-blue-400">
       HatakeSocial
      </span>
     </a>
    </div>
    <nav class="flex-1 px-4 py-6 space-y-2 overflow-y-auto">
     <a class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md" href="app.html">
      <i class="fas fa-home w-6 text-center">
      </i>
      <span class="ml-3">
       Feed
      </span>
     </a>
     <a class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md" href="messages.html">
      <i class="fas fa-comments w-6 text-center">
      </i>
      <span class="ml-3">
       Messages
      </span>
     </a>
     <a class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md" href="community.html">
      <i class="fas fa-users w-6 text-center">
      </i>
      <span class="ml-3">
       Community
      </span>
     </a>
     <a class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md" href="articles.html?type=tcg">
      <i class="fas fa-newspaper w-6 text-center">
      </i>
      <span class="ml-3">
       TCG Articles
      </span>
     </a>
     <a class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md" href="articles.html?type=blog">
      <i class="fas fa-blog w-6 text-center">
      </i>
      <span class="ml-3">
       Hatake Blog
      </span>
     </a>
     <a class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md" href="events.html">
      <i class="fas fa-calendar-alt w-6 text-center">
      </i>
      <span class="ml-3">
       Events
      </span>
     </a>
     <a class="flex items-center px-4 py-2 bg-blue-100 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300 rounded-md" href="my_collection.html">
      <i class="fas fa-layer-group w-6 text-center">
      </i>
      <span class="ml-3">
       My Collection
      </span>
     </a>
     <a class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md" href="deck.html">
      <i class="fas fa-book-open w-6 text-center">
      </i>
      <span class="ml-3">
       Deck Builder
      </span>
     </a>
     <a class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md" href="shop.html">
      <i class="fas fa-shopping-cart w-6 text-center">
      </i>
      <span class="ml-3">
       Shop
      </span>
     </a>
     <a class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md" href="marketplace.html">
      <i class="fas fa-store w-6 text-center">
      </i>
      <span class="ml-3">
       Marketplace
      </span>
     </a>
     <a class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md" href="trades.html">
      <i class="fas fa-exchange-alt w-6 text-center">
      </i>
      <span class="ml-3">
       Trades
      </span>
     </a>
     <a class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md" href="profile.html">
      <i class="fas fa-user w-6 text-center">
      </i>
      <span class="ml-3">
       Profile
      </span>
     </a>
     <a class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md" href="settings.html">
      <i class="fas fa-cog w-6 text-center">
      </i>
      <span class="ml-3">
       Settings
      </span>
     </a>
     <a class="flex items-center px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md" href="about.html">
      <i class="fas fa-info-circle w-6 text-center">
      </i>
      <span class="ml-3">
       About Us
      </span>
     </a>
    </nav>
    <div class="px-4 py-4 border-t border-gray-200 dark:border-gray-700">
     <div id="auth-container-sidebar">
     </div>
    </div>
   </aside>
   <div class="flex-1 flex flex-col overflow-hidden">
    <header class="h-28 flex items-center justify-between px-6 border-b border-gray-200 dark:border-gray-700 flex-shrink-0">
     <div class="flex items-center">
      <button class="lg:hidden mr-4 text-gray-600 dark:text-gray-300 p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 touch-manipulation relative" id="sidebar-toggle" style="min-width: 44px; min-height: 44px; z-index: 1000; position: relative;">
       <i class="fas fa-bars text-xl">
       </i>
      </button>
      <div class="relative">
       <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
       </i>
       <input class="w-full md:w-96 pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-full bg-gray-50 dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500" id="main-search-bar" placeholder="Search for cards, users, or articles..." type="text"/>
      </div>
     </div>
     <div class="flex items-center space-x-5" id="user-actions">
     </div>
    </header>
    <main class="flex-1 overflow-hidden flex">
<div id="filter-panel" class="w-full md:w-80 bg-white dark:bg-gray-800 border-r dark:border-gray-700 p-6 flex-shrink-0 flex flex-col overflow-y-auto">      <div class="mb-6">
       <h3 class="text-lg font-semibold mb-3" id="stats-title">
        Statistics
       </h3>
       <div class="space-y-2 text-sm">
        <div class="flex justify-between">
         <span id="stats-total-label">
          Total Cards:
         </span>
         <span class="font-mono" id="stats-total-cards">
          0
         </span>
        </div>
        <div class="flex justify-between">
         <span id="stats-unique-label">
          Unique Cards:
         </span>
         <span class="font-mono" id="stats-unique-cards">
          0
         </span>
        </div>
        <div class="flex justify-between">
         <span id="stats-value-label">
          Total Value:
         </span>
         <span class="font-mono" id="stats-total-value">
          $0.00
         </span>
        </div>
       </div>
      </div>
      <div class="mb-6 flex-1">
       <h3 class="text-lg font-semibold mb-3">
        Filters
       </h3>
       <div class="space-y-4">
        <input class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500" id="filter-name" placeholder="Filter by name..." type="text"/>


<div class="mb-3">
    <button class="w-full text-left flex items-center justify-between p-2 bg-gray-200 dark:bg-gray-700 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600" onclick="toggleCheckboxes('set-checkboxes')">
        <span>Set/Edition</span>
        <i class="fas fa-chevron-down"></i>
    </button>
    <div id="set-checkboxes" class="hidden mt-2 p-2 bg-gray-50 dark:bg-gray-800 rounded-md max-h-48 overflow-y-auto">
        </div>
</div>

<div class="mb-3">
    <button class="w-full text-left flex items-center justify-between p-2 bg-gray-200 dark:bg-gray-700 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600" onclick="toggleCheckboxes('rarity-checkboxes')">
        <span>Rarity</span>
        <i class="fas fa-chevron-down"></i>
    </button>
    <div id="rarity-checkboxes" class="hidden mt-2 p-2 bg-gray-50 dark:bg-gray-800 rounded-md max-h-48 overflow-y-auto">
        </div>
</div>
        <div id="game-specific-filters">
        </div>
        <button class="w-full text-left flex items-center p-2 bg-gray-200 dark:bg-gray-700 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600" id="clear-filters-btn">
         <i class="fas fa-times w-6">
         </i>
         Clear Filters
        </button>
       </div>
      </div>
      <div>
       <h3 class="text-lg font-semibold mb-3">
        Actions
       </h3>
       <div class="space-y-2">
        <button class="w-full text-left flex items-center p-2 bg-blue-600 text-white rounded-md hover:bg-blue-700" id="add-card-btn">
         <i class="fas fa-plus w-6">
         </i>
         Add Card
        </button>
        <button class="w-full text-left flex items-center p-2 bg-gray-200 dark:bg-gray-700 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600" id="bulk-edit-btn">
         <i class="fas fa-edit w-6">
         </i>
         Bulk Edit
        </button>
        <button class="w-full text-left flex items-center p-2 bg-gray-200 dark:bg-gray-700 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600" id="csv-import-btn">
         <i class="fas fa-file-csv w-6">
         </i>
         Import from CSV
        </button>
        <button class="w-full text-left flex items-center p-2 bg-gray-200 dark:bg-gray-700 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600" id="analyze-value-btn">
         <i class="fas fa-chart-line w-6">
         </i>
         Analyze Value
        </button>
       </div>
      </div>
     </div>
     <div class="flex-1 flex flex-col overflow-hidden p-6">
      <div class="flex-shrink-0 mb-4">
       <div class="flex flex-wrap justify-between items-center gap-4">
        <div class="flex space-x-1 bg-gray-200 dark:bg-gray-700 p-1 rounded-full text-sm font-semibold">
         <button class="tab-button flex-1 px-4 py-2 rounded-full active" data-tab="collection">
          Collection
         </button>
         <button class="tab-button flex-1 px-4 py-2 rounded-full" data-tab="wishlist">
          Wishlist
         </button>
        </div>
        <div class="flex space-x-2 bg-gray-200 dark:bg-gray-700 p-1 rounded-full text-sm font-semibold" id="game-filter-container">
         <label class="flex items-center space-x-2 px-3 py-1 rounded-full cursor-pointer hover:bg-gray-300 dark:hover:bg-gray-600">
          <input type="checkbox" data-game="mtg" class="form-checkbox h-4 w-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
          <span>
           Magic
          </span>
         </label>
         <label class="flex items-center space-x-2 px-3 py-1 rounded-full cursor-pointer hover:bg-gray-300 dark:hover:bg-gray-600">
          <input type="checkbox" data-game="pokemon" class="form-checkbox h-4 w-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
          <span>
           Pokémon
          </span>
         </label>
         <label class="flex items-center space-x-2 px-3 py-1 rounded-full cursor-pointer hover:bg-gray-300 dark:hover:bg-gray-600">
          <input type="checkbox" data-game="lorcana" class="form-checkbox h-4 w-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
          <span>
           Lorcana
          </span>
         </label>
         <label class="flex items-center space-x-2 px-3 py-1 rounded-full cursor-pointer hover:bg-gray-300 dark:hover:bg-gray-600">
          <input type="checkbox" data-game="gundam" class="form-checkbox h-4 w-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
          <span>
           Gundam
          </span>
         </label>
        </div>
        <div class="flex items-center space-x-4">
         <div class="flex items-center bg-gray-200 dark:bg-gray-700 rounded-full p-1">
          <button class="p-2 rounded-full text-gray-800 dark:text-gray-200 bg-white dark:bg-gray-900 shadow" id="view-toggle-grid">
           <i class="fas fa-th-large">
           </i>
          </button>
          <button class="p-2 rounded-full text-gray-500 dark:text-gray-400" id="view-toggle-list">
           <i class="fas fa-list">
           </i>
          </button>
         </div>
        </div>
       </div>
      </div>
      <div class="hidden mb-4 p-4 rounded-lg bg-blue-100 dark:bg-blue-900/50 shadow-md flex items-center justify-between gap-4" id="bulk-edit-toolbar">
       <div class="flex items-center gap-4">
        <p class="text-sm font-semibold text-blue-800 dark:text-blue-200">
         <span id="bulk-selected-count">
          0
         </span>
         selected
        </p>
        <button class="btn btn-sm bg-blue-200 text-blue-800 hover:bg-blue-300" id="bulk-select-all-btn">
         Select All
        </button>
       </div>
       <div class="flex items-center space-x-2">
        <button class="btn btn-success" id="bulk-list-btn">
         <i class="fas fa-tag mr-2">
         </i>
         List for Sale
        </button>
        <button class="btn btn-warning bg-orange-500 hover:bg-orange-600 text-white" id="bulk-remove-marketplace-btn">
         <i class="fas fa-store-slash mr-2">
         </i>
         Remove from Marketplace
        </button>
        <button class="btn bg-red-500 hover:bg-red-600 text-white" id="bulk-delete-btn">
         <i class="fas fa-trash mr-2">
         </i>
         Delete Selected
        </button>
       </div>
      </div>
      <div class="flex-1 overflow-y-auto" id="collection-display">
       <div class="flex items-center justify-center h-full text-gray-500">
        <p>
         Loading your collection...
        </p>
       </div>
      </div>
      <div class="hidden flex-1 flex-col overflow-hidden" id="analytics-dashboard">
       <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow">
         <h4 class="text-sm font-medium text-gray-500 dark:text-gray-400">
          Current Value
         </h4>
         <p class="text-2xl font-semibold" id="analytics-current-value">
          $0.00
         </p>
        </div>
        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow">
         <h4 class="text-sm font-medium text-gray-500 dark:text-gray-400">
          24-Hour Change
         </h4>
         <p class="text-2xl font-semibold" id="analytics-24h-change">
          $0.00
         </p>
        </div>
        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow">
         <h4 class="text-sm font-medium text-gray-500 dark:text-gray-400">
          All-Time High
         </h4>
         <p class="text-2xl font-semibold" id="analytics-all-time-high">
          $0.00
         </p>
        </div>
       </div>
       <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow flex-1">
        <canvas id="value-chart">
        </canvas>
       </div>
       <div class="mt-4">
        <h3 class="text-lg font-semibold mb-2">
         Top Movers
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="top-movers-container">
        </div>
       </div>
      </div>
     </div>
    </main>
   </div>
  </div>
  <div class="fixed bottom-5 right-5 z-[1003]" id="toast-container">
  </div>
  <div class="fixed z-[1005] pointer-events-none hidden rounded-xl shadow-lg" id="card-preview-tooltip">
   <div class="flex" id="card-preview-image-container">
   </div>
  </div>
  <div class="fixed inset-0 bg-black bg-opacity-75 hidden items-start justify-center z-[1001] pt-16" id="search-modal">
   <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-2xl flex flex-col" style="height: 80vh;">
    <div class="p-4 border-b dark:border-gray-700 flex items-center">
     <div class="relative flex-grow mr-4">
      <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
      </i>
      <input class="w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-full bg-gray-50 dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500" id="card-search-input" placeholder="Search for a card..." type="text"/>
     </div>
     <select class="p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600" id="game-selector">
      <option value="mtg">
       Magic: The Gathering
      </option>
      <option value="pokemon">
       Pokémon
      </option>
      <option value="lorcana">
       Lorcana
      </option>
      <option value="gundam">
       Gundam
      </option>
     </select>
     <button class="ml-4 text-gray-500 hover:text-gray-800 dark:hover:text-white text-2xl font-bold" data-modal-close="search-modal">
      ×
     </button>
    </div>
    <div class="p-6 flex-grow overflow-y-auto" id="search-results-container">
     <p class="text-center text-gray-500">
      Search results will appear here.
     </p>
    </div>
   </div>
  </div>
  <div class="fixed inset-0 bg-black bg-opacity-75 hidden items-center justify-center z-[1010]" id="card-modal">
   <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-4xl flex" style="max-height: 90vh;">
    <div class="w-1/3 p-6 bg-gray-100 dark:bg-gray-900 rounded-l-lg flex items-center justify-center">
     <img class="max-w-full max-h-full rounded-lg object-contain" id="card-modal-image" src="https://placehold.co/300x420?text=Card+Image"/>
    </div>
    <div class="w-2/3 p-6 flex flex-col">
     <form class="flex flex-col h-full" id="card-form">
      <input id="card-modal-id" type="hidden"/>
      <input id="card-api-id" type="hidden"/>
      <div class="flex justify-between items-start">
       <div>
        <h2 class="text-2xl font-bold" id="card-modal-title">
         Add New Card
        </h2>
        <p class="text-sm text-gray-500" id="card-modal-subtitle">
         Details for this version
        </p>
       </div>
       <button class="text-gray-500 hover:text-gray-800 dark:hover:text-white text-2xl font-bold" data-modal-close="card-modal" type="button">
        ×
       </button>
      </div>
      <div class="flex-grow overflow-y-auto pr-2">
       <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
         <label class="block text-sm font-medium" for="card-quantity">
          Quantity
         </label>
         <input class="mt-1 w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600" id="card-quantity" min="1" type="number" value="1"/>
        </div>
        <div>
         <label class="block text-sm font-medium" for="card-condition">
          Condition
         </label>
         <select class="mt-1 w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600" id="card-condition">
          <option>
           Near Mint
          </option>
          <option>
           Lightly Played
          </option>
          <option>
           Moderately Played
          </option>
          <option>
           Heavily Played
          </option>
          <option>
           Damaged
          </option>
         </select>
        </div>
        <div>
         <label class="block text-sm font-medium" for="card-language">
          Language
         </label>
         <select class="mt-1 w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600" id="card-language">
          <option>
           English
          </option>
          <option>
           Japanese
          </option>
          <option>
           French
          </option>
          <option>
           German
          </option>
          <option>
           Spanish
          </option>
          <option>
           Italian
          </option>
          <option>
           Portuguese
          </option>
          <option>
           Russian
          </option>
          <option>
           Korean
          </option>
          <option>
           Chinese (Simplified)
          </option>
          <option>
           Chinese (Traditional)
          </option>
         </select>
        </div>
        <div>
         <label class="block text-sm font-medium" for="card-purchase-price">
          Purchase Price
         </label>
         <input class="mt-1 w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600" id="card-purchase-price" placeholder="Optional" type="number"/>
        </div>
       </div>
       
       <!-- Market Price Display Section -->
       <div class="mt-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg" id="market-price-section">
        <h4 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Market Prices</h4>
        <div class="grid grid-cols-2 gap-4">
        <div id="normal-price-display" class="text-center p-3 bg-white dark:bg-gray-600 rounded-lg cursor-pointer border-2 border-transparent hover:border-blue-300 transition-colors">
         <div class="flex items-center justify-center mb-1">
          <input type="radio" name="card-finish" value="normal" id="finish-normal" class="mr-2" checked>
          <label for="finish-normal" class="text-xs text-gray-500 dark:text-gray-400 cursor-pointer">Normal</label>
         </div>
         <div id="normal-price-value" class="text-lg font-semibold text-green-600 dark:text-green-400">-</div>
         <div id="normal-condition-price" class="text-xs text-gray-600 dark:text-gray-300 mt-1">Near Mint</div>
        </div>
        <div id="foil-price-display" class="text-center p-3 bg-white dark:bg-gray-600 rounded-lg cursor-pointer border-2 border-transparent hover:border-blue-300 transition-colors">
         <div class="flex items-center justify-center mb-1">
          <input type="radio" name="card-finish" value="foil" id="finish-foil" class="mr-2">
          <label for="finish-foil" class="text-xs text-gray-500 dark:text-gray-400 cursor-pointer flex items-center">
           <i class="fas fa-star text-yellow-500 mr-1"></i>
           <span id="foil-label-text">Foil</span>
          </label>
         </div>
         <div id="foil-price-value" class="text-lg font-semibold text-yellow-600 dark:text-yellow-400">-</div>
         <div id="foil-condition-price" class="text-xs text-gray-600 dark:text-gray-300 mt-1">Near Mint</div>
        </div>
        </div>
        <div class="text-xs text-gray-500 dark:text-gray-400 text-center mt-2">
         Prices adjust based on selected condition
        </div>
       </div>
       <div class="mt-4 space-y-2">
        <label class="flex items-center">
         <input class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" id="card-is-foil" type="checkbox"/>
         <span class="ml-2 text-sm">
          Foil
         </span>
        </label>
        <label class="flex items-center">
         <input class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" id="card-is-signed" type="checkbox"/>
         <span class="ml-2 text-sm">
          Signed
         </span>
        </label>
        <label class="flex items-center">
         <input class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" id="card-is-altered" type="checkbox"/>
         <span class="ml-2 text-sm">
          Altered
         </span>
        </label>
        <label class="flex items-center">
         <input class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" id="card-is-graded" type="checkbox"/>
         <span class="ml-2 text-sm">
          Is this card graded?
         </span>
        </label>
       </div>
       <div class="mt-4 grid grid-cols-2 gap-4 hidden" id="graded-section">
        <div>
         <label class="block text-sm font-medium" for="grading-company">
          Grading Company
         </label>
         <select class="mt-1 w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600" id="grading-company">
          <option>
           PSA
          </option>
          <option>
           BGS
          </option>
          <option>
           CGC
          </option>
         </select>
        </div>
        <div>
         <label class="block text-sm font-medium" for="grade">
          Grade
         </label>
         <select class="mt-1 w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600" id="grade">
          <option>
           10
          </option>
          <option>
           9
          </option>
          <option>
           8
          </option>
          <option>
           7
          </option>
          <option>
           6
          </option>
          <option>
           5
          </option>
          <option>
           4
          </option>
          <option>
           3
          </option>
          <option>
           2
          </option>
          <option>
           1
          </option>
         </select>
        </div>
       </div>
       <div class="mt-4">
        <label class="block text-sm font-medium" for="card-notes">
         Notes
        </label>
        <textarea class="mt-1 w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600" id="card-notes" placeholder="Add any personal notes about this card..." rows="3">
        </textarea>
       </div>
       <div class="mt-4">
        <label class="block text-sm font-medium">
         Custom Image
        </label>
        <input class="mt-1 w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100" id="custom-image-upload" type="file"/>
       </div>
       <div class="mt-4 border-t pt-4 dark:border-gray-700" id="pending-versions-container">
        <h3 class="text-lg font-semibold mb-2">
         Other Versions
        </h3>
        <div id="pending-versions-list">
        </div>
        <button class="mt-2 text-sm text-blue-600 hover:underline" id="add-another-version-btn" type="button">
         + Add another version (e.g., different language, condition)
        </button>
       </div>
      </div>
      <div class="mt-6 flex justify-end space-x-4 flex-shrink-0">
       <button class="btn btn-secondary" id="delete-card-btn" type="button">
        Delete
       </button>
       <button class="btn btn-primary" id="save-card-btn" type="submit">
        Add to Collection
       </button>
      </div>
     </form>
    </div>
   </div>
  </div>
  <div class="fixed inset-0 bg-black bg-opacity-75 hidden items-center justify-center z-[1003]" id="bulk-review-modal">
   <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-4xl flex flex-col" style="height: 90vh;">
    <div class="flex justify-between items-center p-4 border-b dark:border-gray-700">
     <h2 class="text-xl font-bold">
      Review and Price Items for Sale
     </h2>
     <button class="text-gray-500 hover:text-gray-800 dark:hover:text-white text-2xl font-bold" data-modal-close="bulk-review-modal">
      ×
     </button>
    </div>
    <div class="p-4 bg-gray-50 dark:bg-gray-700/50 border-b dark:border-gray-700">
     <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div>
       <label class="block text-sm font-medium" for="bulk-apply-percentage">
        Apply % to All
       </label>
       <div class="flex items-center">
        <input class="mt-1 w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600" id="bulk-apply-percentage-input" placeholder="e.g., 75" type="number"/>
        <button class="ml-2 btn btn-primary" id="bulk-apply-percentage-btn">
         %
        </button>
       </div>
      </div>
     </div>
    </div>
    <div class="flex-grow overflow-y-auto p-4 space-y-2" id="bulk-review-list">
    </div>
    <div class="p-4 border-t dark:border-gray-700">
     <button class="btn btn-success w-full" id="finalize-bulk-list-btn">
      Finalize and List Selected Cards
     </button>
    </div>
   </div>
  </div>
  <div class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50" id="loginModal">
   <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md p-6">
    <div class="flex justify-between items-center">
     <h2 class="text-xl font-bold">
      Login
     </h2>
     <button class="text-gray-500 hover:text-gray-800 dark:hover:text-white text-2xl font-bold" id="closeLoginModal">
      ×
     </button>
    </div>
    <form class="mt-4 space-y-4" id="loginForm">
     <input class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600" id="loginEmail" placeholder="Email" required="" type="email"/>
     <input class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600" id="loginPassword" placeholder="Password" required="" type="password"/>
     <p class="text-red-500 text-sm hidden" id="login-error-message">
     </p>
     <button class="w-full bg-blue-600 text-white font-semibold py-2 rounded-md hover:bg-blue-700" type="submit">
      Login
     </button>
     <button class="w-full bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-200 font-semibold py-2 rounded-md border dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-600 flex items-center justify-center" id="googleLoginButton" type="button">
      <img alt="Google icon" class="w-5 h-5 mr-2" src="https://www.svgrepo.com/show/475656/google-color.svg"/>
      Sign in with Google
     </button>
    </form>
   </div>
  </div>
  <div class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50" id="registerModal">
   <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md p-6">
    <div class="flex justify-between items-center">
     <h2 class="text-xl font-bold">
      Register
     </h2>
     <button class="text-gray-500 hover:text-gray-800 dark:hover:text-white text-2xl font-bold" id="closeRegisterModal">
      ×
     </button>
    </div>
    <form class="mt-4 space-y-4" id="registerForm">
     <input class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600" id="registerEmail" placeholder="Email" required="" type="email"/>
     <input class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600" id="registerPassword" placeholder="Password" required="" type="password"/>
     <input class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600" id="registerCity" placeholder="City" type="text"/>
     <input class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600" id="registerCountry" placeholder="Country" type="text"/>
     <input class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600" id="registerFavoriteTcg" placeholder="Favorite TCG" type="text"/>
     <p class="text-red-500 text-sm hidden" id="register-error-message">
     </p>
     <button class="w-full bg-blue-600 text-white font-semibold py-2 rounded-md hover:bg-blue-700" type="submit">
      Register
     </button>
     <button class="w-full bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-200 font-semibold py-2 rounded-md border dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-600 flex items-center justify-center" id="googleRegisterButton" type="button">
      <img alt="Google icon" class="w-5 h-5 mr-2" src="https://www.svgrepo.com/show/475656/google-color.svg"/>
      Register with Google
     </button>
    </form>
   </div>
  </div>
   <div class="fixed inset-0 bg-black bg-opacity-75 hidden items-center justify-center z-[1003]" id="csv-import-modal">
   <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-lg flex flex-col">
    <div class="p-4 border-b dark:border-gray-700 flex justify-between items-center">
     <h2 class="text-xl font-bold">
      Import from CSV
     </h2>
     <button class="text-gray-500 hover:text-gray-800 dark:hover:text-white text-2xl font-bold" data-modal-close="csv-import-modal">
      ×
     </button>
    </div>
    <div class="p-6 space-y-4">
     <p class="text-sm text-gray-600 dark:text-gray-400">
      Select a CSV file to import. Compatible with ManaBox exports and other CSV formats.
     </p>
     <div class="text-xs text-gray-500 dark:text-gray-400 mb-2">
      <strong>Supported formats:</strong> CSV files with headers like "Name", "Quantity", "Set Name", "Condition", "Foil", etc.
     </div>
     <input accept=".csv" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600" id="csv-file-input" type="file"/>
     <div class="mt-4">
    <label for="csv-game-selector" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Select Game</label>
    <select id="csv-game-selector" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md dark:bg-gray-700 dark:border-gray-600">
        <option value="mtg" selected>Magic: The Gathering</option>
        <option value="pokemon">Pokémon</option>
        <option value="lorcana">Lorcana</option>
        <option value="gundam">Gundam</option>
    </select>
</div>
     <div class="text-sm text-center p-2 rounded-md" id="csv-import-status">
     </div>
     <div class="hidden mt-4" id="csv-preview">
        <h3 class="text-lg font-semibold mb-2">CSV Preview</h3>
        <p class="text-sm text-gray-500 mb-2">Found <span id="csv-preview-count">0</span> cards.</p>
        <div class="max-h-60 overflow-y-auto border dark:border-gray-600 rounded-md" id="csv-preview-table">
        </div>
    </div>
    </div>
     <div class="p-4 border-t dark:border-gray-700">
        <button class="w-full bg-blue-600 text-white font-semibold py-2 rounded-md hover:bg-blue-700" id="start-csv-import-btn">
            Parse CSV
        </button>
     </div>
   </div>
  </div>
  <div class="fixed inset-0 bg-black bg-opacity-75 hidden items-center justify-center z-[1004]" id="csv-review-modal">
   <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-6xl flex flex-col" style="height: 90vh;">
    <div class="p-4 border-b dark:border-gray-700 flex justify-between items-center">
     <h2 class="text-xl font-bold">
      Review CSV Import
     </h2>
     <button class="text-gray-500 hover:text-gray-800 dark:hover:text-white text-2xl font-bold" data-modal-close="csv-review-modal">
      ×
     </button>
    </div>
    <div class="flex-grow overflow-y-auto p-4">
     <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-600">
      <thead class="bg-gray-50 dark:bg-gray-700">
       <tr>
        <th class="p-3 text-left text-xs font-medium uppercase tracking-wider">
         Name
        </th>
        <th class="p-3 text-left text-xs font-medium uppercase tracking-wider">
         Set
        </th>
        <th class="p-3 text-left text-xs font-medium uppercase tracking-wider">
         Collector #
        </th>
        <th class="p-3 text-left text-xs font-medium uppercase tracking-wider">
         Quantity
        </th>
        <th class="p-3 text-left text-xs font-medium uppercase tracking-wider">
         Condition
        </th>
        <th class="p-3 text-left text-xs font-medium uppercase tracking-wider">
         Language
        </th>
        <th class="p-3 text-left text-xs font-medium uppercase tracking-wider">
         Foil
        </th>
        <th class="p-3 text-left text-xs font-medium uppercase tracking-wider">
         Status
        </th>
        <th class="p-3 text-left text-xs font-medium uppercase tracking-wider">
         Actions
        </th>
       </tr>
      </thead>
      <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-600" id="csv-review-table-body">
      </tbody>
     </table>
    </div>
    <div class="p-4 border-t dark:border-gray-700">
     <div class="hidden w-full mb-4" id="csv-import-progress-container">
      <div class="flex justify-between mb-1">
       <span class="text-base font-medium text-blue-700 dark:text-white" id="csv-progress-text">
        Importing...
       </span>
       <span class="text-sm font-medium text-blue-700 dark:text-white" id="csv-progress-percentage">
        0%
       </span>
      </div>
      <div class="w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-700">
       <div class="bg-blue-600 h-2.5 rounded-full" id="csv-progress-bar" style="width: 0%">
       </div>
      </div>
     </div>
     <button class="btn btn-success w-full" id="finalize-csv-import-btn">
      Finalize Import
     </button>
    </div>
   </div>
  </div>
  <div class="fixed inset-0 bg-black bg-opacity-75 hidden items-center justify-center z-[1006]" id="card-history-modal">
   <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-4xl">
    <div class="p-4 border-b dark:border-gray-700 flex justify-between items-center">
     <h2 class="text-xl font-bold" id="card-history-modal-title">
      Price History
     </h2>
     <button class="text-gray-500 hover:text-gray-800 dark:hover:text-white text-2xl font-bold" data-modal-close="card-history-modal">
      ×
     </button>
    </div>
    <div class="p-6">
     <canvas id="card-history-chart" style="height: 400px;">
     </canvas>
    </div>
   </div>
  </div>

  <!-- Individual Sale Modal -->
  <div class="fixed inset-0 bg-black bg-opacity-75 hidden items-center justify-center z-[1007]" id="individual-sale-modal">
   <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-2xl">
    <div class="p-4 border-b dark:border-gray-700 flex justify-between items-center">
     <h2 class="text-xl font-bold">List Card for Sale</h2>
     <button class="text-gray-500 hover:text-gray-800 dark:hover:text-white text-2xl font-bold" data-modal-close="individual-sale-modal">
      ×
     </button>
    </div>
    
    <!-- Card Preview Section -->
    <div class="p-4 bg-gray-50 dark:bg-gray-700/50 border-b dark:border-gray-700">
     <div class="flex items-center space-x-4">
      <img id="individual-sale-card-image" src="" alt="Card Image" class="w-20 h-28 object-cover rounded-lg">
      <div class="flex-1">
       <h3 id="individual-sale-card-name" class="text-lg font-semibold"></h3>
       <p id="individual-sale-card-set" class="text-sm text-gray-600 dark:text-gray-400"></p>
       <p id="individual-sale-card-condition" class="text-sm text-gray-500 dark:text-gray-400"></p>
       <div class="mt-2">
        <span class="text-sm font-medium">Market Price: </span>
        <span id="individual-sale-market-price" class="font-mono font-semibold text-green-600 dark:text-green-400"></span>
       </div>
      </div>
     </div>
    </div>

    <!-- Pricing Options Section -->
    <div class="p-6 space-y-6">
     <!-- Quantity Selection (for cards with multiple copies) -->
     <div id="individual-sale-quantity-section" class="hidden">
      <label class="block text-sm font-medium mb-2">Quantity to List</label>
      <div class="flex items-center space-x-2">
       <input type="number" id="individual-sale-quantity" min="1" value="1" class="w-20 p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600">
       <span class="text-sm text-gray-500">of <span id="individual-sale-total-quantity">1</span> available</span>
      </div>
     </div>

     <!-- Condition Override (if different from current) -->
     <div id="individual-sale-condition-section" class="hidden">
      <label class="block text-sm font-medium mb-2">Condition (if different)</label>
      <select id="individual-sale-condition-override" class="w-full p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600">
       <option value="">Use current condition</option>
       <option value="mint">Mint</option>
       <option value="near_mint">Near Mint</option>
       <option value="excellent">Excellent</option>
       <option value="good">Good</option>
       <option value="light_played">Light Played</option>
       <option value="played">Played</option>
       <option value="poor">Poor</option>
      </select>
     </div>

     <!-- Pricing Options -->
     <div class="space-y-4">
      <h4 class="text-lg font-semibold">Set Your Price</h4>
      
      <!-- Percentage of Market Value -->
      <div class="space-y-3">
       <label class="block text-sm font-medium">Percentage of Market Value</label>
       <div class="grid grid-cols-4 gap-2">
        <button type="button" class="percentage-btn p-2 border rounded-md hover:bg-blue-50 dark:hover:bg-blue-900/50" data-percentage="85">85%</button>
        <button type="button" class="percentage-btn p-2 border rounded-md hover:bg-blue-50 dark:hover:bg-blue-900/50" data-percentage="90">90%</button>
        <button type="button" class="percentage-btn p-2 border rounded-md hover:bg-blue-50 dark:hover:bg-blue-900/50" data-percentage="100">100%</button>
        <button type="button" class="percentage-btn p-2 border rounded-md hover:bg-blue-50 dark:hover:bg-blue-900/50" data-percentage="110">110%</button>
       </div>
       <div class="flex items-center space-x-2">
        <input type="number" id="individual-sale-percentage" placeholder="Custom %" min="1" max="500" class="w-24 p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600">
        <span>%</span>
       </div>
      </div>

      <!-- Fixed Price -->
      <div class="space-y-2">
       <label class="block text-sm font-medium">Or Set Fixed Price</label>
       <div class="flex items-center space-x-2">
        <span id="individual-sale-currency-symbol" class="text-lg font-semibold">$</span>
        <input type="number" id="individual-sale-fixed-price" placeholder="0.00" step="0.01" min="0" class="flex-1 p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600">
        <span id="individual-sale-currency-code" class="text-sm text-gray-500">USD</span>
       </div>
      </div>

      <!-- Final Price Display -->
      <div class="p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
       <div class="flex justify-between items-center">
        <span class="font-medium">Your Listing Price:</span>
        <span id="individual-sale-final-price" class="text-xl font-bold text-blue-600 dark:text-blue-400">$0.00</span>
       </div>
       <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">
        <span id="individual-sale-price-comparison"></span>
       </div>
      </div>
     </div>
    </div>

    <!-- Action Buttons -->
    <div class="p-4 border-t dark:border-gray-700 flex justify-end space-x-3">
     <button type="button" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200" data-modal-close="individual-sale-modal">
      Cancel
     </button>
     <button type="button" id="individual-sale-confirm-btn" class="px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed">
      List for Sale
     </button>
    </div>
   </div>
  </div>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js">
  </script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js">
  </script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js">
  </script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-storage-compat.js">
  </script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-functions-compat.js">
  </script>
  <script src="js/auth.js">
  </script>
  <script src="js/mobile-navigation-fixed.js">
  </script>
  <script src="js/darkmode.js">
  </script>
  <script src="js/messenger.js">
  </script>
    <script src="js/modules/collection-app.js" type="module"></script>
    <script src="js/collection-search-integration.js"></script>
  <script src="js/collection-analytics.js">
  </script>
  <script src="js/price-alerts.js">
  </script>
  <script src="js/price-cache.js">
  </script>

  <script>
   document.addEventListener('DOMContentLoaded', () => {
        const sidebar = document.getElementById('sidebar');
        const sidebarToggle = document.getElementById('sidebar-toggle');
        const sidebarOverlay = document.getElementById('sidebar-overlay');
        if (sidebarToggle) {
            sidebarToggle.addEventListener('click', () => {
                if (sidebar.classList.contains('-translate-x-full')) {
                    sidebar.classList.remove('-translate-x-full');
                    sidebar.classList.add('translate-x-0');
                    sidebarOverlay.classList.remove('hidden');
                } else {
                    sidebar.classList.add('-translate-x-full');
                    sidebar.classList.remove('translate-x-0');
                    sidebarOverlay.classList.add('hidden');
                }
            });
        }
        if (sidebarOverlay) {
            sidebarOverlay.addEventListener('click', () => {
                sidebar.classList.add('-translate-x-full');
                sidebarOverlay.classList.add('hidden');
            });
        }
    });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/shepherd.js@10.0.1/dist/js/shepherd.min.js">
  </script>
  <link href="https://cdn.jsdelivr.net/npm/shepherd.js@10.0.1/dist/css/shepherd.css" rel="stylesheet"/>
  <script src="/js/tour.js" type="module">
  </script>
 </body>
</html>